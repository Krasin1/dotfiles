USER_NAME="xxx"

// WIFI
ip addr show -> interface name (wlan0)
iwctl
    station INT_NAME get-networks
iwctl --passphrase "PASSWORD" station INT_NAME connect WIFI_NAME

// FS
cfdisk
    boot - 500M 
    swap - 8G 
    root - rest of disk

mkfs.ext4 /dev/sda3         - root
mkfs.fat -F 32 /dev/sda1    - boot
mkswap /dev/sda2            - swap

mount /dev/sda3 /mnt
mkdir -p /mnt/boot/efi
mount /dev/sda1 /mnt/boot/efi
swapon /dev/sda2

pacstrap -K /mnt base base-devel linux linux-firmware sof-firmware linux-headers neovim git grub dosfstools efibootmgr os-prober mtools networkmanager rustup zsh

// WINDOWS DRIVE
mkdir -p /mnt/media/windows1
mount /dev/sdb1 /mnt/media/windows1 - windows partition

// FSTAB
genfstab -U /mnt >> /mnt/etc/fstab

arch-chroot /mnt

// SETUP
ln -s /usr/share/zoneinfo/Europe/Moscow /etc/localtime
hwclock --systohc

# Разкомментировать все строки, начинающиеся с ru_RU или en_US
sudo sed -i 's/^#\(ru_RU\|en_US\)/\1/' /etc/locale.gen
locale-gen
echo 'LANG=en_US.UTF-8' > /etc/locale.conf

echo 'arch' > /etc/hostname
echo 'root password' | passwd
passwd 


echo 'Creating user $USER_NAME'
useradd -m -G wheel -s /bin/zsh $USER_NAME
passwd $USER_NAME
usermod -aG power,video,storage,optical,input,audio $USER_NAME

echo " -- Changing visudo"
echo '%wheel ALL=(ALL:ALL) NOPASSWD: ALL' | sudo tee -a /etc/sudoers >/dev/null
sudo visudo -c

systemctl enable NetworkManager

sudo sed -i '/GRUB_DISABLE_OS_PROBER/d' /etc/default/grub
echo "GRUB_DISABLE_OS_PROBER=false" | sudo tee -a /etc/default/grub
grub-install --target=x86_64-efi --bootloader-id=GRUB --recheck
grub-mkconfig -o /boot/grub/grub.cfg

echo " -- pacman.conf"
sudo sed -i 's/^#Color$/Color/' /etc/pacman.conf
# Добавить ILoveCandy после Color
sudo sed -i '/^Color$/a ILoveCandy' /etc/pacman.conf
# Раскомментировать VerbosePkgLists
sudo sed -i 's/^#VerbosePkgLists$/VerbosePkgLists/' /etc/pacman.conf
# Раскомментировать блок [multilib]
sudo sed -i '/^#\[multilib\]$/,+1 s/^#//' /etc/pacman.conf

pacman -Syyuu reflector rsync
reflector -c 'Russia,' -a 6 --sort rate --save /etc/pacman.d/mirrorlist

sudo "Switching to user"
su xxx
rustup install nightly stable
rustup default stable

git clone https://aur.archlinux.org/paru.git
cd paru
makepkg -si
cd

git clone https://github.com/Krasin1/dotfiles
cd dotfiles
paru -S lsd stow 
stow zsh nvim kitty clangd clang-format config_cfgs dunst eww git rofi wallpapers yazi zathura mpv
paru -S \
    amd-ucode xf86-video-amdgpu vulkan-radeon \
    brillo \
    bluez bluez-utils blueman \
    network-manager-applet \
    clang gdb \
    ttf-cascadia-code ttf-font-awesome ttf-material-design-icons-desktop-git \
    papirus-icon-theme qogir-gtk-theme qogir-icon-theme \
    pipewire pipewire-alsa pipewire-jack pipewire-pulse \
    alsa-utils wireplumber qpwgraph pavucontrol \
    mpd mpd-mpris mpc ncmpcpp \
    mpv mpv-mpris \
    eww-git playerctl sysstat \
    dunst rofi udiskie fbreader \ 
    hyprland swaybg grimblast-git swappy \
    cliphist wl-clip \
    lsd lolcat btop neofetch nemo p7zip stow engrampa \
    yazi ffmpeg 7zip jq poppler fd ripgrep fzf zoxide resvg imagemagick ueberzugpp \
    zathura zathura-pdf-poppler \
    firefox \
    hiddify \
    polkit polkit-gnome \
    vesktop-bin qdirstat-bin \

// dkms xrdp(xorgxrdp??) ??xrdp-debug

-- amd-ucode xf86-video-amdgpu vulkan-radeon // ноут

brillo 
ddcci-driver-linux-dkms ddcutil
    cp ~/dotfiles/backlight/blacklist.conf /etc/modprobe.d/
    cp ~/dotfiles/backlight/ddcci.conf /etc/modprobe.d/
    cp ~/dotfiles/backlight/ddcci@.service /etc/systemd/system/
    cp ~/dotfiles/backlight/99-ddcci.rules /etc/udev/rules.d/
    sudo systemctl daemon-reload
    // if needed manually : echo 'ddcci 0x37' | sudo tee /sys/bus/i2c/devices/i2c-*/new_device 

bluez bluez-utils blueman
    sudo systemctl enable bluetooth.service


xf86-video-intel vulkan-intel intel-ucode clang gdb 

ttf-cascadia-code ttf-font-awesome ttf-material-design-icons-desktop-git papirus-icon-theme
ttf-maple ttf-inconsolata ttf-joypixels ttf-terminus-nerd ttf-jetbrains-mono-nerd

gwe(GreenWithEnvy)
nvidia nvidia-settings nvidia-utils ??? lib32-nvidia-utils

huawei-wmi

pipewire pipewire-alsa pipewire-jack pipewire-pulse alsa-utils wireplumber qpwgraph  pavucontrol
//for lutris maybe lib32-pipewire (lib32-libpulse in does not work)

mpd mpd-mpris mpc ncmpcpp 
    ln -s /media/windows2/!MUSIC ~/Music
    playlist : .m3u format -----> ./song.flac
    systemctl --user enable --now mpd.service 
    systemctl --user enable --now mpd-mpris -- notifications + playerctl control
    in ncmpcpp press "u" to update playlists

mpv mpv-mpris // для отображения в playerctl

eww-git playerctl sysstat(disk usage)

xorg-xinit

bspwm sxhkd polybar picom  // dmenu

dunst rofi udiskie fbreader simple-mtpfs(можно без simple?: gvfs-mtp,jmtpfs??)

xclip openrazer dex(автозагрузка в .config/autostart)

nitrogen -- x11
swaybg -- wayland

cliphist wl-clip

zsh kitty neovim lsd lolcat btop neofetch nemo p7zip stow engrampa(rar archive)

paru -S yazi ffmpeg 7zip jq poppler fd ripgrep fzf zoxide resvg imagemagick ueberzugpp -- ? python-pynvim  

zathura zathura-pdf-poppler chromium

arcolinux-logout betterlockscreen 

hiddify

grimblast-git swappy -- wayland
flameshot -- x11

polkit polkit-gnome
-- add to autostart /usr/lib/polkit-gnome/polkit-gnome-authentication-agent-1 &
-- for root winodw input

// vesktop-bin qdirstat-bin

android-studio libbcd

libc++

    xdg-mime default nemo.desktop inode/directory

-- /etc/pacman.conf
    Color
    CheckSpace
    VerbosePkgLists
    ParallelDownloads = 5
    ILoveCandy
    multilib in the end

-- lxappearance-gtk3
    qogir-gtk-theme qogir-icon-theme 

-- git dotfiles repository
    git update-index --assume-unchanged mpd/.config/mpd/mpdstate
    git update-index --assume-unchanged mpd/.config/mpd/mpd.db

-- add to /etc/fstab windows partition 
    UUID=<use from lsblk -f> /windows ntfs defaults 0 0

-- hibernation laptop
/etc/systemd/logind.conf -> uncomment and change to hibernate: HandleLidSwitch=hibernate
    then sudo systemctl restart systemd.service 
/etc/mkinitcpio.conf -> add to HOOKS (resume)
    then mkinitcpio -p linux

-- touchpad gestures on laptop
    install libinput libinput-gestures gestures 
/etc/mkinitcpio.conf add to MODULES (i2c_hid) - после гибернации чтоб не пропадали жесты

-- auto-cpufreq for battery life 
    install auto-cpufreq
    sudo auto-cpufreq --install

-- honor battery threshold and fn_lock_state 
    (https://github.com/qu1x/huawei-wmi.git)
    -- maybe sudo usermod -aG huawei-wmi $(whoami)
    sudo -e /usr/lib/huawei-wmi/reinstate
        change      cp -- "$DEF$cct" "$WMI"
        to          echo "20 80" > "$WMI$cct
    sudo -e /sys/devices/huawei-wmi/fn_lock_state 
    sudo systemctl enable --now huawei-wmi-reinstate.service

-- exaile media player
    Что-то из этого поможет запустить alac/m4a:
    paru -S gst-plugins-base-libs gst-libav gst-plugins-base gst-plugins-good

-- nvidia fan control
    nvim /etc/X11/Xwrapper.config изменить на needs_root_rights=yes

-- windows fonts
    ln -s /windows/Windows/Fonts /usr/local/share/fonts/WindowsFonts
    fc-cache --force

-- wake on lan 
    nmcli con show  --> check name
    nmcli c show "wired1" | grep 802-3-ethernet.wake-on-lan --> check WOL status
    nmcli c modify "wired1" 802-3-ethernet.wake-on-lan magic  --> enable

-- dynamic dns 
    install ddclient
    edit /etc/ddclient/ddclient.conf
        protocol=duckdns,
        password=<token>
        naobumluboi.duckdns.org
    sudo systemctl enable --now ddclient

-- change default terminal
    sudo ln -s /usr/bin/kitty /usr/bin/gnome-terminal

-- ssh keys for git
    ssh-keygen -t ed25519 -C "bdunaeb@yandex.ru" -f ~/.ssh/git_ssh
    maybe chmod 700 ~/.ssh
    systemctl --user enable --now ssh-agent.service
    env = SSH_AUTH_SOCK, $XDG_RUNTIME_DIR/ssh-agent.socket
    ssh-add ~/.ssh/git_ssh

-- libvirt
    paru -S swtpm qemu qemu-full virt-manager virt-viewer dnsmasq vde2 bridge-utils openbsd-netcat libguestfs
    sudo useradd -aG kvm xxx
    sudo useradd -aG libvirt xxx
    sudo systemctl enable --now libvirtd

    virsh net-start default
    virsh net-autostart default
    mkdir -p ~/.config/libvirt
    echo 'uri_default = "qemu:///system"' > ~/.config/libvirt/libvirt.conf

    windows 11:
        oobe\bypassnro
        https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/latest-virtio/virtio-win.iso
        spice guest tools
        win fsp
        service:
            virtlo-fs service automatic start
        add hardware -> filesystem virtiofs
