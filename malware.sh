#!/bin/sh

# while true; do
#     read -p " -- Did you partition your drive? : " yn
#     case $yn in
#         [Yy]* ) echo "Okey"; break;;
#         [Nn]* ) exit;;
#         * ) echo "Please answer yes or no.";;
#     esac
# done

$USER_NAME="xxx"
# # WIFI
# ip addr show -> interface name (wlan0)
# iwctl
#     station INT_NAME get-networks
# iwctl --passphrase "PASSWORD" station INT_NAME connect WIFI_NAME

# FS
# cfdisk
#     boot - 500M 
#     swap - 8G 
#     root - rest of disk
#
# mkfs.ext4 /dev/sda3         - root
# mkfs.fat -F 32 /dev/sda1    - boot
# mkswap /dev/sda2            - swap
#
# mount /dev/sda3 /mnt
# mkdir -p /mnt/boot/efi
# mount /dev/sda1 /mnt/boot/efi
# swapon /dev/sda2
#
# pacstrap -K /mnt base base-devel linux linux-firmware sof-firmware linux-headers neovim git grub dosfstools efibootmgr os-prober mtools networkmanager rustup zsh
#
# # WINDOWS DRIVE
# mkdir -p /mnt/media/windows1
# mount /dev/sdb1 /mnt/media/windows1 - windows partition
#
# # FSTAB
# genfstab -U /mnt >> /mnt/etc/fstab

# arch-chroot /mnt

# SETUP
ln -s /usr/share/zoneinfo/Europe/Moscow /etc/localtime
hwclock --systohc

# Разкомментировать все строки, начинающиеся с ru_RU или en_US
sudo sed -i "s/^#\(ru_RU\|en_US\)/\1/" /etc/locale.gen
locale-gen
echo "LANG=en_US.UTF-8" > /etc/locale.conf

echo "arch" > /etc/hostname
echo "root password" | passwd
passwd 


echo "Creating user $USER_NAME"
useradd -m -G wheel -s /bin/zsh $USER_NAME
passwd $USER_NAME
usermod -aG power,video,storage,optical,input,audio $USER_NAME

echo " -- Changing visudo"
echo "%wheel ALL=(ALL:ALL) NOPASSWD: ALL" | sudo tee -a /etc/sudoers >/dev/null
sudo visudo -c

systemctl enable NetworkManager

sudo sed -i "/GRUB_DISABLE_OS_PROBER/d" /etc/default/grub
echo "GRUB_DISABLE_OS_PROBER=false" | sudo tee -a /etc/default/grub
grub-install --target=x86_64-efi --bootloader-id=GRUB --recheck
grub-mkconfig -o /boot/grub/grub.cfg

echo " -- pacman.conf"
sudo sed -i "s/^#Color$/Color/" /etc/pacman.conf
# Добавить ILoveCandy после Color
sudo sed -i "/^Color$/a ILoveCandy" /etc/pacman.conf
# Раскомментировать VerbosePkgLists
sudo sed -i "s/^#VerbosePkgLists$/VerbosePkgLists/" /etc/pacman.conf
# Раскомментировать блок [multilib]
sudo sed -i "/^#\[multilib\]$/,+1 s/^#//" /etc/pacman.conf

pacman -Syyuu reflector rsync
reflector -c "Russia," -a 6 --sort rate --save /etc/pacman.d/mirrorlist

sudo "Switching to user"
su xxx
rustup install nightly stable
rustup default stable

git clone https://aur.archlinux.org/paru.git
cd paru
makepkg -si
cd

git clone https://github.com/Krasin1/dotfiles
cd dotfiles
paru -S lsd stow 
stow zsh nvim kitty clangd clang-format config_cfgs dunst eww git rofi wallpapers yazi zathura mpv
paru -S \
    amd-ucode xf86-video-amdgpu vulkan-radeon \
    brillo \
    bluez bluez-utils \
    clang gdb \
    ttf-cascadia-code ttf-font-awesome ttf-material-design-icons-desktop-git \
    papirus-icon-theme qogir-gtk-theme qogir-icon-theme \
    pipewire pipewire-alsa pipewire-jack pipewire-pulse \
    alsa-utils wireplumber qpwgraph pavucontrol \
    mpd mpd-mpris mpc ncmpcpp \
    mpv mpv-mpris \
    eww-git playerctl sysstat \
    dunst rofi udiskie fbreader \ 
    hyprland swaybg grimblast-git swappy \
    cliphist wl-clip \
    lsd lolcat btop neofetch nemo p7zip stow engrampa \
    yazi ffmpeg 7zip jq poppler fd ripgrep fzf zoxide resvg imagemagick ueberzugpp \
    zathura zathura-pdf-poppler \
    firefox \
    hiddify \
    polkit polkit-gnome \
    vesktop-bin qdirstat-bin \


# echo " -- Enter root password" 
# passwd

# echo " -- Installing packages"

# echo " -- Installing mpd"
# stow mpd
# cp ~/.config/mpd/log_template ~/.config/mpd/log
# cp ~/.config/mpd/mpd.db_template ~/.config/mpd/mpd.db
# cp ~/.config/mpd/mpdstate_template ~/.config/mpd/mpdstate
# systemctl --user enable mpd.service 
# systemctl --user enable mpd-mpris 
#
# echo " -- Installing ncmpcpp"
# stow ncmpcpp
# cp ~/.config/ncmpcpp/error.log_template ~/.config/ncmpcpp/error.log
